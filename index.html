<!DOCTYPE html>
<html dir="rtl" lang="he" id="htmlRoot">
<!--
/**
 * Standalone Appointment Booking System
 * 
 * Purpose: This is a standalone HTML file that can be hosted on any web server
 * (GitHub Pages, Firebase Hosting, Cloudflare Pages, etc.) to avoid the cookie
 * and security issues that come with Google Apps Script Web Apps.
 * 
 * Method of Operation:
 * 1. This file contains all HTML, CSS, and JavaScript needed for the booking interface
 * 2. It communicates with the Google Apps Script backend via fetch API
 * 3. No iframe is used, which eliminates third-party cookie issues
 * 4. The URL appears normal to security software, eliminating false warnings
 * 
 * Setup Instructions:
 * 1. Deploy the Google Apps Script as a Web App (doGet/doPost must be accessible)
 * 2. Copy the deployed Web App URL
 * 3. Update the API_URL constant below with your Web App URL
 * 4. Host this file on any static hosting service
 * 
 * @author Moyshi
 * @created 2025-12-18
 */
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="page-title">拽注转 驻砖 </title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
<style>
/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Heebo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    min-height: 100dvh;
    background: white;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
}

/* Header Styles */
.header {
    background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
    color: white;
    padding: 2rem 1.5rem;
    text-align: center;
}

.header-content {
    max-width: 600px;
    margin: 0 auto;
}

.header-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.9;
}

.header-title {
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.header-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    font-weight: 300;
}

/* Main Content */
.main-content {
    flex: 1;
    padding: 2rem 1.5rem;
    width: 100%;
}

/* Step Container */
.step-container {
    max-width: 600px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease-in-out;
}

.step-container.hidden {
    display: none;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Step Header */
.step-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f0f0f0;
    flex-wrap: wrap;
    gap: 1rem;
}

.step-header .step-content {
    display: flex;
    align-items: center;
}

.step-number {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #4285f4, #34a853);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1.2rem;
    margin-left: 1rem;
}

.step-title {
    font-size: 1.8rem;
    font-weight: 600;
    color: #333;
}

/* Language Toggle Button */
.language-toggle {
    display: flex;
    align-items: center;
}

.btn-language {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border: 2px solid #dee2e6;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 500;
    color: #495057;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
}

.btn-language:hover {
    background: linear-gradient(135deg, #e9ecef, #dee2e6);
    border-color: #adb5bd;
    color: #212529;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.btn-language i {
    font-size: 1rem;
    color: #4285f4;
}

/* RTL/LTR Support */
[dir="ltr"] .step-number {
    margin-left: 0;
    margin-right: 1rem;
}

[dir="ltr"] .form-label i {
    margin-left: 0;
    margin-right: 0.5rem;
}

[dir="ltr"] .btn .fas {
    order: 2;
}

[dir="ltr"] .btn span {
    order: 1;
}

[dir="ltr"] .calendar-nav#prevMonth i:before {
    content: "\f053"; /* fa-chevron-left */
}

[dir="ltr"] .calendar-nav#nextMonth i:before {
    content: "\f054"; /* fa-chevron-right */
}

[dir="ltr"] .step-actions {
    flex-direction: row-reverse;
}

/* English Font Support */
[lang="en"] {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* Form Styles */
.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: flex;
    align-items: center;
    font-weight: 500;
    color: #555;
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.form-label i {
    margin-left: 0.5rem;
    color: #4285f4;
}

.form-input,
.form-select {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
    background: white;
}

.form-input:focus,
.form-select:focus {
    outline: none;
    border-color: #4285f4;
    box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
}

.form-input::placeholder {
    color: #999;
}

/* Duration Info */
.duration-info {
    margin-top: 0.5rem;
    padding: 0.75rem;
    background: linear-gradient(135deg, #e8f5e8, #f0f8ff);
    border-radius: 6px;
    font-size: 0.9rem;
    color: #2e7d32;
    border-right: 4px solid #4caf50;
    display: none;
}

.duration-info.show {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        max-height: 0;
    }
    to {
        opacity: 1;
        max-height: 100px;
    }
}

/* Error Messages */
.error-message {
    color: #d32f2f;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: none;
}

.error-message.show {
    display: block;
}

/* Button Styles */
.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none;
    font-family: inherit;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.btn-primary {
    background: linear-gradient(135deg, #4285f4, #1976d2);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    background: linear-gradient(135deg, #1976d2, #1565c0);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
}

.btn-secondary {
    background: #f5f5f5;
    color: #666;
    border: 1px solid #ddd;
}

.btn-secondary:hover {
    background: #e0e0e0;
    color: #333;
}

.btn-success {
    background: linear-gradient(135deg, #4caf50, #388e3c);
    color: white;
}

.btn-success:hover {
    background: linear-gradient(135deg, #388e3c, #2e7d32);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

/* Step Actions */
.step-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
    gap: 1rem;
}

/* Calendar Styles */
.calendar-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    margin-bottom: 2rem;
}

.calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-bottom: 1px solid #dee2e6;
}

.calendar-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: #333;
}

.calendar-nav {
    background: none;
    border: none;
    font-size: 1.2rem;
    color: #666;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.calendar-nav:hover {
    background: #e0e0e0;
    color: #333;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: #f0f0f0;
    padding: 1px;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    position: relative;
}

.calendar-day:hover {
    background: #f0f8ff;
}

.calendar-day.disabled {
    color: #ccc;
    cursor: not-allowed;
    background: #f9f9f9;
}

.calendar-day.selected {
    background: linear-gradient(135deg, #4285f4, #1976d2);
    color: white;
}

.calendar-day.today {
    background: #fff3e0;
    color: #f57c00;
    font-weight: 600;
}

.calendar-day.today.selected {
    background: linear-gradient(135deg, #4285f4, #1976d2);
    color: white;
}

/* Day Headers */
.calendar-day-header {
    background: #f8f9fa;
    color: #666;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: default;
}

/* Time Slots */
.time-slots-container {
    margin-bottom: 2rem;
}

.selected-date-info {
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    text-align: center;
    font-weight: 500;
    color: #1976d2;
    border-right: 4px solid #2196f3;
}

.time-slots-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 0.75rem;
    margin-top: 1rem;
}

.time-slot {
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    font-weight: 500;
}

.time-slot:hover {
    border-color: #4285f4;
    background: #f0f8ff;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.time-slot.selected {
    background: linear-gradient(135deg, #4285f4, #1976d2);
    color: white;
    border-color: #1976d2;
}

.time-slot-time {
    font-size: 1rem;
    margin-bottom: 0.25rem;
}

.time-slot-duration {
    font-size: 0.8rem;
    opacity: 0.8;
}

/* Loading States */
.loading {
    text-align: center;
    padding: 2rem;
    color: #666;
}

.loading i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: #4285f4;
}

.no-slots-message {
    text-align: center;
    padding: 3rem 2rem;
    color: #666;
}

.no-slots-message i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #ccc;
}

/* Confirmation Styles */
.confirmation-details {
    margin-bottom: 2rem;
}

.confirmation-card {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 12px;
    padding: 2rem;
    border-right: 4px solid #4caf50;
}

.confirmation-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    color: #2e7d32;
    font-size: 1.3rem;
}

.confirmation-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #e0e0e0;
}

.confirmation-item:last-child {
    border-bottom: none;
}

.confirmation-label {
    font-weight: 500;
    color: #666;
}

.confirmation-value {
    font-weight: 600;
    color: #333;
}

/* Success Message */
.success-message {
    text-align: center;
    padding: 2rem;
}

.success-icon {
    font-size: 4rem;
    color: #4caf50;
    margin-bottom: 1rem;
}

.success-title {
    font-size: 2rem;
    font-weight: 600;
    color: #2e7d32;
    margin-bottom: 0.5rem;
}

.success-subtitle {
    color: #666;
    margin-bottom: 2rem;
}

.success-details {
    background: linear-gradient(135deg, #e8f5e8, #f0f8ff);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    text-align: right;
}

.success-actions {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.loading-overlay.hidden {
    display: none;
}

.loading-spinner {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.loading-spinner i {
    font-size: 2rem;
    color: #4285f4;
    margin-bottom: 1rem;
}

/* Footer */
.footer {
    background: #f8f9fa;
    padding: 1rem;
    text-align: center;
    color: #666;
    font-size: 0.875rem;
    border-top: 1px solid #e0e0e0;
}

.mb-2 { margin-bottom: 1rem; }
.mb-3 { margin-bottom: 1.5rem; }

/* Enhanced Mobile Responsiveness - Tablet and larger phones (768px and below) */
@media screen and (max-width: 768px) {
    /* Enhanced form inputs and selects */
    .form-input, .form-select {
        padding: 1.5rem 2rem !important;
        font-size: 1.6rem !important;
        height: 80px !important;
        line-height: 1.4 !important;
        border-radius: 12px !important;
        border: 2px solid #e1e5e9 !important;
        background: #fff !important;
        transition: all 0.3s ease !important;
    }

    .form-input:focus, .form-select:focus {
        border-color: #4285f4 !important;
        box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1) !important;
        transform: translateY(-2px) !important;
    }

    /* Enhanced buttons */
    .btn {
        padding: 1.5rem 2.5rem !important;
        font-size: 1.6rem !important;
        font-weight: 600 !important;
        height: 80px !important;
        min-height: 80px !important;
        border-radius: 12px !important;
        border: none !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 0.75rem !important;
        text-align: center !important;
        line-height: 1.4 !important;
    }

    .btn:hover:not(:disabled) {
        transform: translateY(-3px) !important;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }

    /* Enhanced calendar */
    .calendar-grid {
        gap: 8px !important;
    }

    .calendar-day {
        height: 70px !important;
        font-size: 1.6rem !important;
        font-weight: 500 !important;
        border-radius: 12px !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .calendar-nav {
        width: 60px !important;
        height: 60px !important;
        font-size: 1.8rem !important;
        border-radius: 50% !important;
        border: none !important;
        background: rgba(255,255,255,0.2) !important;
        color: white !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* Enhanced time slots */
    .time-slots-grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr !important;
        gap: 12px !important;
        margin-top: 1.5rem !important;
    }

    .time-slot {
        padding: 1.5rem !important;
        font-size: 1.6rem !important;
        font-weight: 600 !important;
        height: 90px !important;
        border-radius: 12px !important;
        border: 2px solid #e1e5e9 !important;
        background: white !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        text-align: center !important;
    }

    /* Enhanced headers and titles */
    .header-title {
        font-size: 2.8rem !important;
        font-weight: 700 !important;
        margin-bottom: 0.75rem !important;
        line-height: 1.2 !important;
    }

    .step-title {
        font-size: 2.2rem !important;
        font-weight: 600 !important;
        line-height: 1.3 !important;
    }

    .form-label {
        font-size: 1.4rem !important;
        font-weight: 600 !important;
        margin-bottom: 0.75rem !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }

    /* Enhanced step containers */
    .step-container {
        max-width: 100vw !important;
        width: 100% !important;
        margin: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }

    .form-group {
        margin-bottom: 2rem !important;
    }

    /* Enhanced confirmation items */
    .confirmation-item {
        padding: 1.5rem !important;
        font-size: 1.4rem !important;
        border-radius: 8px !important;
        margin-bottom: 1rem !important;
        background: #f8f9fa !important;
        border: 1px solid #e9ecef !important;
    }

    .container {
        max-width: 100vw !important;
        min-width: 0 !important;
        margin: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
    }

    body, html {
        padding: 0 !important;
        margin: 0 !important;
        overflow-x: hidden !important;
    }
}

/* Enhanced Mobile Responsiveness - Small phones (480px and below) */
@media screen and (max-width: 480px) {
    /* Even larger for small phones */
    .form-input, .form-select {
        padding: 2rem 2.5rem !important;
        font-size: 1.8rem !important;
        height: 90px !important;
        line-height: 1.4 !important;
        border-radius: 15px !important;
        text-align: center !important;
    }

    /* Extra large buttons for small phones */
    .btn {
        padding: 2rem 3rem !important;
        font-size: 1.8rem !important;
        font-weight: 700 !important;
        height: 90px !important;
        min-height: 90px !important;
        border-radius: 15px !important;
        gap: 1rem !important;
    }

    /* Enhanced calendar for small phones */
    .calendar-day {
        height: 80px !important;
        font-size: 1.8rem !important;
        font-weight: 600 !important;
        border-radius: 15px !important;
    }

    .calendar-nav {
        width: 70px !important;
        height: 70px !important;
        font-size: 2rem !important;
    }

    /* Full width time slots for small phones */
    .time-slots-grid {
        grid-template-columns: 1fr !important;
        gap: 15px !important;
    }

    .time-slot {
        padding: 2rem !important;
        font-size: 1.8rem !important;
        font-weight: 700 !important;
        height: 100px !important;
        border-radius: 15px !important;
    }

    /* Extra large headers for small phones */
    .header-title {
        font-size: 3.2rem !important;
        font-weight: 800 !important;
        line-height: 1.1 !important;
    }

    .step-title {
        font-size: 2.6rem !important;
        font-weight: 700 !important;
        line-height: 1.2 !important;
    }

    .form-label {
        font-size: 1.6rem !important;
        font-weight: 700 !important;
    }

    /* Enhanced container padding for small phones */
    .step-container {
        max-width: 100vw !important;
        width: 100% !important;
        margin: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }

    .main-content {
        padding: 1.5rem !important;
    }

    .header {
        padding: 2.5rem 1.5rem !important;
    }

    /* Enhanced confirmation for small phones */
    .confirmation-item {
        padding: 2rem !important;
        font-size: 1.6rem !important;
        border-radius: 12px !important;
    }

    .confirmation-label {
        font-weight: 700 !important;
        font-size: 1.7rem !important;
    }

    .confirmation-value {
        font-size: 1.6rem !important;
        font-weight: 600 !important;
    }

    .container {
        max-width: 100vw !important;
        min-width: 0 !important;
        margin: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
    }

    body, html {
        padding: 0 !important;
        margin: 0 !important;
        overflow-x: hidden !important;
    }

    /* Enhanced step header for mobile */
    .step-header {
        flex-direction: column !important;
        align-items: center !important;
        text-align: center !important;
        gap: 1.5rem !important;
    }

    .step-content {
        flex-direction: column !important;
        align-items: center !important;
        gap: 1rem !important;
    }

    .step-number {
        margin: 0 !important;
        width: 60px !important;
        height: 60px !important;
        font-size: 1.8rem !important;
    }

    .language-toggle {
        order: -1; /* Put language toggle above on mobile */
    }
}

/* Utility Classes */
.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mt-1 { margin-top: 0.5rem; }
.mt-2 { margin-top: 1rem; }
.mt-3 { margin-top: 1.5rem; }
.mb-1 { margin-bottom: 0.5rem; }
</style>

</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <i class="fas fa-calendar-check header-icon"></i>
                <h1 class="header-title" data-translate="header-title">拽注转 驻砖 </h1>
                <p class="header-subtitle" data-translate="header-subtitle">专 转  转  拽注 驻砖 拽转</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Personal Information -->
            <div class="step-container" id="step1">
                <div class="step-header">
                    <div class="step-content">
                        <div class="step-number">1</div>
                        <h2 class="step-title" data-translate="step1-title">驻专 砖</h2>
                    </div>
                    <!-- Language Toggle Button -->
                    <div class="language-toggle">
                        <button type="button" class="btn-language" id="languageToggle">
                            <i class="fas fa-globe"></i>
                            <span data-translate="switch-to-english">English</span>
                        </button>
                    </div>
                </div>
                
                <form autocomplete="on">
                
                <div class="form-group">
                    <label for="clientName" class="form-label">
                        <i class="fas fa-user"></i>
                        <span data-translate="label-name">砖 </span>
                    </label>
                    <input type="text" 
                           id="clientName" 
                           name="name" 
                           class="form-input" 
                           data-translate-placeholder="placeholder-name"
                           placeholder="住 转 砖 " 
                           autocomplete="name"
                           required>
                    <div class="error-message" id="nameError"></div>
                </div>

                <div class="form-group">
                    <label for="clientPhone" class="form-label">
                        <i class="fas fa-phone"></i>
                        <span data-translate="label-phone">住驻专 驻</span>
                    </label>
                    <input type="tel" 
                           id="clientPhone" 
                           name="phone" 
                           class="form-input" 
                           data-translate-placeholder="placeholder-phone"
                           placeholder="050-1234567" 
                           autocomplete="tel"
                           required>
                    <div class="error-message" id="phoneError"></div>
                </div>

                <div class="form-group">
                    <label for="clientEmail" class="form-label">
                        <i class="fas fa-envelope"></i>
                        <span data-translate="label-email">转转 </span>
                    </label>
                    <input type="email" 
                           id="clientEmail" 
                           name="email" 
                           class="form-input" 
                           data-translate-placeholder="placeholder-email"
                           placeholder="your-email@example.com" 
                           autocomplete="email"
                           required>
                    <div class="error-message" id="emailError"></div>
                </div>

                <div class="form-group">
                    <label for="numberOfPeople" class="form-label">
                        <i class="fas fa-users"></i>
                        <span data-translate="label-people"> 转 转 ?</span>
                    </label>
                    <select id="numberOfPeople" class="form-select" required>
                        <option value="" data-translate="select-people">专 住驻专 转</option>
                        <option value="1" data-translate="people-1">1 转</option>
                        <option value="2" data-translate="people-2">2 转</option>
                        <option value="3" data-translate="people-3">3 转</option>
                        <option value="4" data-translate="people-4">4 转</option>
                        <option value="5" data-translate="people-5">5 转</option>
                        <option value="6" data-translate="people-6">6 转</option>
                        <option value="7" data-translate="people-7">7 转</option>
                        <option value="8" data-translate="people-8">8 转</option>
                        <option value="9" data-translate="people-9">9 转</option>
                    </select>
                    <div class="duration-info" id="durationInfo"></div>
                    <div class="error-message" id="peopleError"></div>
                </div>

                <button type="button" class="btn btn-primary" id="continueToDate" disabled>
                    <span data-translate="continue-date">砖 专转 转专</span>
                    <i class="fas fa-arrow-left" id="arrowIcon"></i>
                </button>
                </form>
            </div>

            <!-- Step 2: Date Selection -->
            <div class="step-container hidden" id="step2">
                <div class="step-header">
                    <div class="step-content">
                        <div class="step-number">2</div>
                        <h2 class="step-title" data-translate="step2-title">专转 转专</h2>
                    </div>
                </div>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <button type="button" class="calendar-nav" id="prevMonth">
                            <i class="fas fa-chevron-right" id="prevIcon"></i>
                        </button>
                        <h3 class="calendar-title" id="calendarTitle"></h3>
                        <button type="button" class="calendar-nav" id="nextMonth">
                            <i class="fas fa-chevron-left" id="nextIcon"></i>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="step-actions">
                    <button type="button" class="btn btn-secondary" id="backToStep1">
                        <i class="fas fa-arrow-right" id="backIcon1"></i>
                        <span data-translate="back">专</span>
                    </button>
                    <button type="button" class="btn btn-primary" id="continueToTime" disabled>
                        <span data-translate="continue-time">砖 专转 砖注</span>
                        <i class="fas fa-arrow-left" id="arrowIcon2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Time Selection -->
            <div class="step-container hidden" id="step3">
                <div class="step-header">
                    <div class="step-content">
                        <div class="step-number">3</div>
                        <h2 class="step-title" data-translate="step3-title">专转 砖注</h2>
                    </div>
                </div>

                <div class="selected-date-info" id="selectedDateInfo"></div>

                <div class="time-slots-container">
                    <div class="loading" id="timeSlotsLoading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span data-translate="loading-slots">注 砖注转 驻转...</span>
                    </div>
                    <div class="time-slots-grid" id="timeSlotsGrid"></div>
                    <div class="no-slots-message hidden" id="noSlotsMessage">
                        <i class="fas fa-calendar-times"></i>
                        <p data-translate="no-slots"> 砖注转 驻转 转专 </p>
                        <p data-translate="choose-another"> 专 转专 专</p>
                    </div>
                </div>

                <div class="step-actions">
                    <button type="button" class="btn btn-secondary" id="backToStep2">
                        <i class="fas fa-arrow-right" id="backIcon2"></i>
                        <span data-translate="back">专</span>
                    </button>
                    <button type="button" class="btn btn-primary" id="continueToConfirm" disabled>
                        <span data-translate="continue-confirm">砖 砖专</span>
                        <i class="fas fa-arrow-left" id="arrowIcon3"></i>
                    </button>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="step-container hidden" id="step4">
                <div class="step-header">
                    <div class="step-content">
                        <div class="step-number">4</div>
                        <h2 class="step-title" data-translate="step4-title">砖专 驻专 驻砖</h2>
                    </div>
                </div>

                <div class="confirmation-details">
                    <div class="confirmation-card">
                        <h3 class="confirmation-title">
                            <i class="fas fa-check-circle"></i>
                            <span data-translate="confirmation-title">住 驻砖</span>
                        </h3>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-name">砖:</span>
                            <span class="confirmation-value" id="confirmName"></span>
                        </div>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-phone">驻:</span>
                            <span class="confirmation-value" id="confirmPhone"></span>
                        </div>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-email">:</span>
                            <span class="confirmation-value" id="confirmEmail"></span>
                        </div>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-people">住驻专 转:</span>
                            <span class="confirmation-value" id="confirmPeople"></span>
                        </div>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-date">转专:</span>
                            <span class="confirmation-value" id="confirmDate"></span>
                        </div>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-time">砖注:</span>
                            <span class="confirmation-value" id="confirmTime"></span>
                        </div>
                        
                        <div class="confirmation-item">
                            <span class="confirmation-label" data-translate="confirm-duration">砖 驻砖:</span>
                            <span class="confirmation-value" id="confirmDuration"></span>
                        </div>
                    </div>
                </div>

                <div class="step-actions">
                    <button type="button" class="btn btn-secondary" id="backToStep3">
                        <i class="fas fa-arrow-right" id="backIcon3"></i>
                        <span data-translate="back">专</span>
                    </button>
                    <button type="button" class="btn btn-success" id="confirmBooking">
                        <i class="fas fa-check"></i>
                        <span data-translate="confirm-booking">砖专 转拽注 驻砖</span>
                    </button>
                </div>
            </div>

            <!-- Success Message -->
            <div class="step-container hidden" id="successStep">
                <div class="success-message">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2 class="success-title" data-translate="success-title">驻砖 拽注 爪!</h2>
                    <p class="success-subtitle" data-translate="success-subtitle">转拽 砖专 " 拽专</p>
                    
                    <div class="success-details" id="successDetails"></div>
                    
                    <div class="success-actions">
                        <button type="button" class="btn btn-success" id="addToCalendar">
                            <i class="fas fa-calendar-plus"></i>
                            <span data-translate="add-calendar">住驻  砖</span>
                        </button>
                        <button type="button" class="btn btn-primary" id="bookAnother">
                            <i class="fas fa-plus"></i>
                            <span data-translate="book-another">拽注 驻砖 住驻转</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p data-translate="footer-text">&copy; 2024 注专转 拽注转 转专 -   注专</p>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p data-translate="booking-progress">拽注 转 驻砖...</p>
        </div>
    </div>

<script>
/**
 * Standalone Client-side JavaScript for the Appointment Booking System
 * 
 * This script handles all the frontend logic including:
 * - Form validation and navigation between steps
 * - Calendar display and date selection
 * - Time slot management and selection
 * - Communication with Google Apps Script backend via fetch API
 * - User interface interactions and animations
 * - Multilingual support (Hebrew/English)
 * 
 * IMPORTANT: This version uses fetch API instead of google.script.run
 * to allow hosting on external servers (GitHub Pages, Firebase, etc.)
 * 
 * @author Moyshi
 * @created 2025-12-18
 */

// ============================================================================
// CONFIGURATION - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
// ============================================================================
/**
 * The URL of your deployed Google Apps Script Web App
 * 
 * How to get this URL:
 * 1. Open your Google Apps Script project
 * 2. Click "Deploy" -> "Manage deployments"
 * 3. Copy the "Web app URL" that starts with https://script.google.com/macros/s/...
 * 4. Paste it here
 * 
 * IMPORTANT: Make sure the Web App is deployed with:
 * - Execute as: Me (your email)
 * - Who has access: Anyone
 */
const API_URL = 'https://script.google.com/macros/s/AKfycby-Sz_7MoVGlmi67f7EKBTrl-P5xtnWa3D4zWMxXerBt8vcmQR5sYwmvTOTSutEvLR2/exec';
// ============================================================================

// Global variables
let currentStep = 1;
let selectedDate = null;
let selectedTimeSlot = null;
let appointmentData = {};
let currentMonth = new Date();
let config = {};
let calendarLink = null;
let currentLanguage = 'he'; // Default to Hebrew

// Translations object
const translations = {
    he: {
        'page-title': '拽注转 驻砖 ',
        'header-title': '拽注转 驻砖 ',
        'header-subtitle': '专 转  转  拽注 驻砖 拽转',
        'step1-title': '驻专 砖',
        'step2-title': '专转 转专',
        'step3-title': '专转 砖注',
        'step4-title': '砖专 驻专 驻砖',
        'switch-to-english': 'English',
        'label-name': '砖 ',
        'label-phone': '住驻专 驻',
        'label-email': '转转 ',
        'label-people': ' 转 转 ?',
        'placeholder-name': '住 转 砖 ',
        'placeholder-phone': '050-1234567',
        'placeholder-email': 'your-email@example.com',
        'select-people': '专 住驻专 转',
        'people-1': '1 转',
        'people-2': '2 转',
        'people-3': '3 转',
        'people-4': '4 转',
        'people-5': '5 转',
        'people-6': '6 转',
        'people-7': '7 转',
        'people-8': '8 转',
        'people-9': '9 转',
        'continue-date': '砖 专转 转专',
        'continue-time': '砖 专转 砖注',
        'continue-confirm': '砖 砖专',
        'back': '专',
        'loading-slots': '注 砖注转 驻转...',
        'no-slots': ' 砖注转 驻转 转专 ',
        'choose-another': ' 专 转专 专',
        'confirmation-title': '住 驻砖',
        'confirm-name': '砖:',
        'confirm-phone': '驻:',
        'confirm-email': ':',
        'confirm-people': '住驻专 转:',
        'confirm-date': '转专:',
        'confirm-time': '砖注:',
        'confirm-duration': '砖 驻砖:',
        'confirm-booking': '砖专 转拽注 驻砖',
        'success-title': '驻砖 拽注 爪!',
        'success-subtitle': '转拽 砖专 " 拽专',
        'add-calendar': '住驻  砖',
        'book-another': '拽注 驻砖 住驻转',
        'footer-text': '漏 2024 注专转 拽注转 转专 -   注专',
        'booking-progress': '拽注 转 驻砖...',
        'duration-text': '砖 驻砖:',
        'selected-date': '转专 专:',
        'minutes': '拽转',
        'hours': '砖注转',
        'hour': '砖注',
        'and': '-',
        'girls': '转',
        'girl': '转',
        'confirm-address': ' 转转:',
        'error-name-required': ' 住 转 砖',
        'error-name-length': '砖   驻转 2 转',
        'error-phone-required': ' 住 住驻专 驻',
        'error-phone-invalid': '住驻专 驻  转拽',
        'error-email-required': ' 住 转转 ',
        'error-email-invalid': '转转   转拽',
        'error-people-required': ' 专 住驻专 转',
        'error-api': '砖 转拽砖专转 注 砖专转. 住 砖.',
        'error-config': '砖 注转 专转. 住 专注 转 祝.'
    },
    en: {
        'page-title': 'Book an Appointment for Fitting',
        'header-title': 'Book an Appointment for Fitting',
        'header-subtitle': 'Choose your preferred time and book an appointment easily',
        'step1-title': 'Personal Information',
        'step2-title': 'Select Date',
        'step3-title': 'Select Time',
        'step4-title': 'Confirm Appointment Details',
        'switch-to-english': '注专转',
        'label-name': 'Full Name',
        'label-phone': 'Phone Number',
        'label-email': 'Email Address',
        'label-people': 'How many girls are coming for fitting?',
        'placeholder-name': 'Enter your full name',
        'placeholder-phone': '050-1234567',
        'placeholder-email': 'your-email@example.com',
        'select-people': 'Select number of girls',
        'people-1': '1 girl',
        'people-2': '2 girls',
        'people-3': '3 girls',
        'people-4': '4 girls',
        'people-5': '5 girls',
        'people-6': '6 girls',
        'people-7': '7 girls',
        'people-8': '8 girls',
        'people-9': '9 girls',
        'continue-date': 'Continue to Date Selection',
        'continue-time': 'Continue to Time Selection',
        'continue-confirm': 'Continue to Confirmation',
        'back': 'Back',
        'loading-slots': 'Loading available times...',
        'no-slots': 'No available times on this date',
        'choose-another': 'Please choose another date',
        'confirmation-title': 'Appointment Summary',
        'confirm-name': 'Name:',
        'confirm-phone': 'Phone:',
        'confirm-email': 'Email:',
        'confirm-people': 'Number of girls:',
        'confirm-date': 'Date:',
        'confirm-time': 'Time:',
        'confirm-duration': 'Duration:',
        'confirm-booking': 'Confirm and Book Appointment',
        'success-title': 'Appointment Booked Successfully!',
        'success-subtitle': 'You will receive a confirmation email shortly',
        'add-calendar': 'Add to Your Calendar',
        'book-another': 'Book Another Appointment',
        'footer-text': '漏 2024 Appointment Booking System - Built specially for you',
        'booking-progress': 'Booking your appointment...',
        'duration-text': 'Duration:',
        'selected-date': 'Selected date:',
        'minutes': 'minutes',
        'hours': 'hours',
        'hour': 'hour',
        'and': 'and',
        'girls': 'girls',
        'girl': 'girl',
        'confirm-address': ' Address:',
        'error-name-required': 'Please enter your name',
        'error-name-length': 'Name must contain at least 2 characters',
        'error-phone-required': 'Please enter phone number',
        'error-phone-invalid': 'Invalid phone number',
        'error-email-required': 'Please enter email address',
        'error-email-invalid': 'Invalid email address',
        'error-people-required': 'Please select number of girls',
        'error-api': 'Server communication error. Please try again.',
        'error-config': 'Error loading settings. Please refresh the page.'
    }
};

// Hebrew month names
const hebrewMonths = [
    '专', '驻专专', '专抓', '驻专', '', '',
    '', '住', '住驻专', '拽专', '专', '爪专'
];

// English month names
const englishMonths = [
    'January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'
];

// Hebrew day names
const hebrewDays = ['', '', '', '', '', '', '砖'];

// English day names
const englishDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];

// ============================================================================
// API COMMUNICATION FUNCTIONS
// ============================================================================

/**
 * Makes a GET request to the Google Apps Script API
 * @param {Object} params - Query parameters to send
 * @return {Promise<Object>} The JSON response
 */
async function apiGet(params) {
    const queryString = new URLSearchParams(params).toString();
    const url = `${API_URL}?${queryString}`;
    
    try {
        const response = await fetch(url, {
            method: 'GET',
            mode: 'cors',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API GET error:', error);
        throw error;
    }
}

/**
 * Makes a POST request to the Google Apps Script API
 * Uses a workaround for GAS CORS issues by encoding data in URL
 * 
 * @param {Object} data - Data to send
 * @return {Promise<Object>} The JSON response
 */
async function apiPost(data) {
    try {
        // For Google Apps Script, we need to use GET with encoded data
        // because POST has CORS issues with external domains
        const encodedData = encodeURIComponent(JSON.stringify(data));
        const url = `${API_URL}?action=${data.action}&data=${encodedData}`;
        
        const response = await fetch(url, {
            method: 'GET',
            mode: 'cors',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API POST error:', error);
        throw error;
    }
}

// ============================================================================
// APPLICATION INITIALIZATION
// ============================================================================

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

/**
 * Initialize the application
 */
async function initializeApp() {
    // Check if API URL is configured
    if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
        console.error('API URL not configured! Please update the API_URL constant.');
        alert(t('error-config') + '\n\nPlease configure the API_URL in the HTML file.');
        return;
    }
    
    // Load configuration from server
    try {
        const response = await apiGet({ action: 'getConfig' });
        if (response.success) {
            handleConfigLoaded(response.config);
        } else {
            console.error('Failed to load config:', response.message);
            // Use default config
            handleConfigLoaded({
                baseDuration: 30,
                additionalPersonDuration: 15,
                businessName: '注专转 拽注转 转专'
            });
        }
    } catch (error) {
        console.error('Error loading config:', error);
        // Use default config
        handleConfigLoaded({
            baseDuration: 30,
            additionalPersonDuration: 15,
            businessName: '注专转 拽注转 转专'
        });
    }
    
    // Set up event listeners
    setupEventListeners();
    
    // Initialize calendar
    initializeCalendar();
    
    // Apply initial language
    applyLanguage(currentLanguage);
    
    console.log('Appointment booking system initialized (standalone mode)');
}

/**
 * Handle configuration loaded from server
 */
function handleConfigLoaded(serverConfig) {
    config = serverConfig;
    console.log('Configuration loaded:', config);
}

/**
 * Set up all event listeners
 */
function setupEventListeners() {
    // Language toggle
    document.getElementById('languageToggle').addEventListener('click', toggleLanguage);
    
    // Step 1 - Personal Information
    document.getElementById('clientName').addEventListener('input', validateStep1);
    document.getElementById('clientPhone').addEventListener('input', validateStep1);
    document.getElementById('clientEmail').addEventListener('input', validateStep1);
    document.getElementById('numberOfPeople').addEventListener('change', handlePeopleChange);
    document.getElementById('continueToDate').addEventListener('click', () => goToStep(2));
    
    // Step 2 - Date Selection
    document.getElementById('backToStep1').addEventListener('click', () => goToStep(1));
    document.getElementById('continueToTime').addEventListener('click', () => goToStep(3));
    document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
    document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
    
    // Step 3 - Time Selection
    document.getElementById('backToStep2').addEventListener('click', () => goToStep(2));
    document.getElementById('continueToConfirm').addEventListener('click', () => goToStep(4));
    
    // Step 4 - Confirmation
    document.getElementById('backToStep3').addEventListener('click', () => goToStep(3));
    document.getElementById('confirmBooking').addEventListener('click', confirmBooking);
    
    // Success step
    document.getElementById('bookAnother').addEventListener('click', resetForm);
    document.getElementById('addToCalendar').addEventListener('click', addToCalendar);
}

/**
 * Toggle language between Hebrew and English
 */
function toggleLanguage() {
    currentLanguage = currentLanguage === 'he' ? 'en' : 'he';
    applyLanguage(currentLanguage);
    
    // Re-render calendar with new language
    renderCalendar();
    
    // Update duration info if needed
    if (document.getElementById('numberOfPeople').value) {
        handlePeopleChange();
    }
    
    // Update selected date info if needed
    if (selectedDate) {
        updateSelectedDateInfo();
    }
    
    console.log('Language switched to:', currentLanguage);
}

/**
 * Apply language translations to the page
 */
function applyLanguage(lang) {
    const html = document.getElementById('htmlRoot');
    html.setAttribute('lang', lang);
    html.setAttribute('dir', lang === 'he' ? 'rtl' : 'ltr');
    
    // Update all elements with translation attributes
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    // Update placeholders
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[lang] && translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });
    
    // Update document title
    const titleKey = document.querySelector('title').getAttribute('data-translate');
    if (translations[lang] && translations[lang][titleKey]) {
        document.title = translations[lang][titleKey];
    }
    
    // Update arrow directions for LTR/RTL
    updateArrowDirections(lang);
}

/**
 * Update arrow directions based on language direction
 */
function updateArrowDirections(lang) {
    const isRTL = lang === 'he';
    
    // Update calendar navigation arrows
    const prevIcon = document.getElementById('prevIcon');
    const nextIcon = document.getElementById('nextIcon');
    
    if (prevIcon && nextIcon) {
        if (isRTL) {
            prevIcon.className = 'fas fa-chevron-right';
            nextIcon.className = 'fas fa-chevron-left';
        } else {
            prevIcon.className = 'fas fa-chevron-left';
            nextIcon.className = 'fas fa-chevron-right';
        }
    }
    
    // Update button arrows
    const arrowIcons = [
        'arrowIcon', 'arrowIcon2', 'arrowIcon3',
        'backIcon1', 'backIcon2', 'backIcon3'
    ];
    
    arrowIcons.forEach(iconId => {
        const icon = document.getElementById(iconId);
        if (icon) {
            if (iconId.startsWith('arrow')) {
                icon.className = isRTL ? 'fas fa-arrow-left' : 'fas fa-arrow-right';
            } else {
                icon.className = isRTL ? 'fas fa-arrow-right' : 'fas fa-arrow-left';
            }
        }
    });
}

/**
 * Get translation for a key
 */
function t(key) {
    return translations[currentLanguage] && translations[currentLanguage][key] 
        ? translations[currentLanguage][key] 
        : key;
}

/**
 * Validate step 1 form fields
 */
function validateStep1() {
    const name = document.getElementById('clientName').value.trim();
    const phone = document.getElementById('clientPhone').value.trim();
    const email = document.getElementById('clientEmail').value.trim();
    const people = document.getElementById('numberOfPeople').value;
    
    // Clear previous errors
    clearErrors();
    
    let isValid = true;
    
    // Validate name
    if (!name) {
        showError('nameError', t('error-name-required'));
        isValid = false;
    } else if (name.length < 2) {
        showError('nameError', t('error-name-length'));
        isValid = false;
    }
    
    // Validate phone
    if (!phone) {
        showError('phoneError', t('error-phone-required'));
        isValid = false;
    } else if (!isValidPhone(phone)) {
        showError('phoneError', t('error-phone-invalid'));
        isValid = false;
    }
    
    // Validate email
    if (!email) {
        showError('emailError', t('error-email-required'));
        isValid = false;
    } else if (!isValidEmail(email)) {
        showError('emailError', t('error-email-invalid'));
        isValid = false;
    }
    
    // Validate number of people
    if (!people) {
        showError('peopleError', t('error-people-required'));
        isValid = false;
    }
    
    // Enable/disable continue button
    document.getElementById('continueToDate').disabled = !isValid;
    
    return isValid;
}

/**
 * Handle change in number of people
 */
function handlePeopleChange() {
    const people = parseInt(document.getElementById('numberOfPeople').value);
    const durationInfo = document.getElementById('durationInfo');
    
    if (people) {
        const baseDuration = config.baseDuration || 30;
        const additionalDuration = config.additionalPersonDuration || 15;
        const totalDuration = baseDuration + ((people - 1) * additionalDuration);
        
        // Format duration in a user-friendly way
        let durationText = formatDurationInLanguage(totalDuration);
        
        durationInfo.innerHTML = `
            <i class="fas fa-clock"></i>
            ${t('duration-text')} ${durationText}
        `;
        durationInfo.classList.add('show');
    } else {
        durationInfo.classList.remove('show');
    }
    
    validateStep1();
}

/**
 * Format duration according to current language
 */
function formatDurationInLanguage(minutes) {
    if (currentLanguage === 'he') {
        if (minutes < 60) {
            return `${minutes} ${t('minutes')}`;
        } else {
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;
            
            if (remainingMinutes === 0) {
                return hours === 1 ? t('hour') : `${hours} ${t('hours')}`;
            } else {
                const hoursText = hours === 1 ? t('hour') : `${hours} ${t('hours')}`;
                return `${hoursText} ${t('and')}-${remainingMinutes} ${t('minutes')}`;
            }
        }
    } else {
        if (minutes < 60) {
            return `${minutes} ${t('minutes')}`;
        } else {
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;
            
            if (remainingMinutes === 0) {
                return hours === 1 ? `1 ${t('hour')}` : `${hours} ${t('hours')}`;
            } else {
                const hoursText = hours === 1 ? `1 ${t('hour')}` : `${hours} ${t('hours')}`;
                return `${hoursText} ${t('and')} ${remainingMinutes} ${t('minutes')}`;
            }
        }
    }
}

/**
 * Validate phone number
 */
function isValidPhone(phone) {
    const cleanPhone = phone.replace(/\D/g, '');
    return /^0[2-9]\d{7,8}$/.test(cleanPhone) || /^05\d{8}$/.test(cleanPhone);
}

/**
 * Validate email address
 */
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

/**
 * Show error message
 */
function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = message;
    errorElement.classList.add('show');
}

/**
 * Clear all error messages
 */
function clearErrors() {
    const errorElements = document.querySelectorAll('.error-message');
    errorElements.forEach(element => {
        element.classList.remove('show');
        element.textContent = '';
    });
}

/**
 * Navigate to a specific step
 */
function goToStep(step) {
    // Hide current step
    document.getElementById(`step${currentStep}`).classList.add('hidden');
    
    // Show new step
    document.getElementById(`step${step}`).classList.remove('hidden');
    
    // Update current step
    currentStep = step;
    
    // Handle step-specific logic
    switch (step) {
        case 3:
            loadTimeSlots();
            break;
        case 4:
            populateConfirmation();
            break;
    }
    
    // Scroll to top
    window.scrollTo(0, 0);
}

/**
 * Initialize calendar
 */
function initializeCalendar() {
    currentMonth = new Date();
    renderCalendar();
}

/**
 * Change calendar month
 */
function changeMonth(direction) {
    currentMonth.setMonth(currentMonth.getMonth() + direction);
    renderCalendar();
}

/**
 * Render calendar for current month
 */
function renderCalendar() {
    const calendarTitle = document.getElementById('calendarTitle');
    const calendarGrid = document.getElementById('calendarGrid');
    
    // Set title according to language
    const months = currentLanguage === 'he' ? hebrewMonths : englishMonths;
    calendarTitle.textContent = `${months[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
    
    // Clear grid
    calendarGrid.innerHTML = '';
    
    // Add day headers according to language
    const days = currentLanguage === 'he' ? hebrewDays : englishDays;
    days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day calendar-day-header';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
    });
    
    // Get first day of month and number of days
    const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
    const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    // Add calendar days
    for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = date.getDate();
        
        // Check if date is in current month
        if (date.getMonth() !== currentMonth.getMonth()) {
            dayElement.classList.add('disabled');
        } else {
            // Check if date is in the past
            const today = new Date();
            const todayDateOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            
            if (dateOnly < todayDateOnly) {
                dayElement.classList.add('disabled');
            } else {
                // Check if it's a working day (Sunday-Thursday)
                const dayOfWeek = date.getDay();
                if (dayOfWeek === 5 || dayOfWeek === 6) { // Friday or Saturday
                    dayElement.classList.add('disabled');
                } else {
                    // Add click handler for valid dates
                    dayElement.addEventListener('click', () => selectDate(date));
                    
                    // Check if it's today
                    if (dateOnly.getTime() === todayDateOnly.getTime()) {
                        dayElement.classList.add('today');
                    }
                    
                    // Check if it's selected
                    if (selectedDate && date.toDateString() === selectedDate.toDateString()) {
                        dayElement.classList.add('selected');
                    }
                }
            }
        }
        
        calendarGrid.appendChild(dayElement);
    }
}

/**
 * Select a date
 */
function selectDate(date) {
    selectedDate = new Date(date);
    
    // Update calendar display
    renderCalendar();
    
    // Enable continue button
    document.getElementById('continueToTime').disabled = false;
    
    console.log('Date selected:', selectedDate);
}

/**
 * Update selected date info according to current language
 */
function updateSelectedDateInfo() {
    const selectedDateInfo = document.getElementById('selectedDateInfo');
    selectedDateInfo.textContent = `${t('selected-date')} ${formatDateInLanguage(selectedDate)}`;
}

/**
 * Load available time slots for selected date
 */
async function loadTimeSlots() {
    if (!selectedDate) return;
    
    // Show loading
    document.getElementById('timeSlotsLoading').classList.remove('hidden');
    document.getElementById('timeSlotsGrid').innerHTML = '';
    document.getElementById('noSlotsMessage').classList.add('hidden');
    
    // Update selected date info
    updateSelectedDateInfo();
    
    // Calculate duration
    const people = parseInt(document.getElementById('numberOfPeople').value);
    const baseDuration = config.baseDuration || 30;
    const additionalDuration = config.additionalPersonDuration || 15;
    const duration = baseDuration + ((people - 1) * additionalDuration);
    
    // Format date correctly for Israel timezone
    const year = selectedDate.getFullYear();
    const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
    const day = String(selectedDate.getDate()).padStart(2, '0');
    const dateStr = `${year}-${month}-${day}`;
    
    console.log('Selected date:', selectedDate.toDateString());
    console.log('Date string sent to server:', dateStr);
    
    try {
        const response = await apiGet({
            action: 'getTimeSlots',
            date: dateStr,
            duration: duration
        });
        
        if (response.success) {
            handleTimeSlotsLoaded(response.timeSlots);
        } else {
            handleTimeSlotsError(response.message);
        }
    } catch (error) {
        handleTimeSlotsError(error);
    }
}

/**
 * Handle time slots loaded from server
 */
function handleTimeSlotsLoaded(timeSlots) {
    // Hide loading
    document.getElementById('timeSlotsLoading').classList.add('hidden');
    
    const timeSlotsGrid = document.getElementById('timeSlotsGrid');
    const noSlotsMessage = document.getElementById('noSlotsMessage');
    
    if (timeSlots.length === 0) {
        noSlotsMessage.classList.remove('hidden');
        return;
    }
    
    // Clear previous slots
    timeSlotsGrid.innerHTML = '';
    
    // Add time slots
    timeSlots.forEach(slot => {
        const slotElement = document.createElement('div');
        slotElement.className = 'time-slot';
        slotElement.innerHTML = `
            <div class="time-slot-time">${slot.start} - ${slot.end}</div>
        `;
        
        slotElement.addEventListener('click', () => selectTimeSlot(slot, slotElement));
        
        timeSlotsGrid.appendChild(slotElement);
    });
}

/**
 * Handle time slots loading error
 */
function handleTimeSlotsError(error) {
    document.getElementById('timeSlotsLoading').classList.add('hidden');
    document.getElementById('noSlotsMessage').classList.remove('hidden');
    console.error('Error loading time slots:', error);
}

/**
 * Select a time slot
 */
function selectTimeSlot(slot, element) {
    selectedTimeSlot = slot;
    
    // Update UI
    document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
    element.classList.add('selected');
    
    // Enable continue button
    document.getElementById('continueToConfirm').disabled = false;
    
    console.log('Time slot selected:', slot);
}

/**
 * Populate confirmation details
 */
function populateConfirmation() {
    const name = document.getElementById('clientName').value.trim();
    const phone = document.getElementById('clientPhone').value.trim();
    const email = document.getElementById('clientEmail').value.trim();
    const people = parseInt(document.getElementById('numberOfPeople').value);
    
    // Calculate duration
    const baseDuration = config.baseDuration || 30;
    const additionalDuration = config.additionalPersonDuration || 15;
    const duration = baseDuration + ((people - 1) * additionalDuration);
    
    // Format duration in current language
    const durationText = formatDurationInLanguage(duration);
    
    // Format people count in current language
    const peopleText = currentLanguage === 'he' 
        ? `${people} ${people === 1 ? t('girl') : t('girls')}`
        : `${people} ${people === 1 ? t('girl') : t('girls')}`;
    
    // Update confirmation fields
    document.getElementById('confirmName').textContent = name;
    document.getElementById('confirmPhone').textContent = phone;
    document.getElementById('confirmEmail').textContent = email;
    document.getElementById('confirmPeople').textContent = peopleText;
    document.getElementById('confirmDate').textContent = formatDateInLanguage(selectedDate);
    document.getElementById('confirmTime').textContent = `${selectedTimeSlot.start} - ${selectedTimeSlot.end}`;
    document.getElementById('confirmDuration').textContent = durationText;
    
    // Store appointment data with language preference
    const year = selectedDate.getFullYear();
    const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
    const day = String(selectedDate.getDate()).padStart(2, '0');
    const dateStr = `${year}-${month}-${day}`;
    
    appointmentData = {
        name: name,
        phone: phone,
        email: email,
        numberOfPeople: people,
        selectedSlot: selectedTimeSlot,
        date: dateStr,
        language: currentLanguage
    };
}

/**
 * Confirm and book the appointment
 */
async function confirmBooking() {
    // Show loading overlay
    document.getElementById('loadingOverlay').classList.remove('hidden');
    
    try {
        const response = await apiPost({
            action: 'bookAppointment',
            appointmentData: appointmentData
        });
        
        handleBookingSuccess(response);
    } catch (error) {
        handleBookingError(error);
    }
}

/**
 * Handle successful booking
 */
function handleBookingSuccess(result) {
    // Hide loading overlay
    document.getElementById('loadingOverlay').classList.add('hidden');
    
    if (result && result.success === true && result.eventId) {
        // Store calendar link
        calendarLink = result.calendarLink;
        
        // Show success step
        goToStep('success');
        
        // Update success details in current language
        const successDetails = document.getElementById('successDetails');
        const addressText = currentLanguage === 'he' 
            ? '专 注专 18, 拽 2, 转 砖砖'
            : 'Rav Amram 18, 2nd Floor, Beit Shemesh';
        
        successDetails.innerHTML = `
            <div class="confirmation-item">
                <span class="confirmation-label">${t('confirm-name')}</span>
                <span class="confirmation-value">${appointmentData.name}</span>
            </div>
            <div class="confirmation-item">
                <span class="confirmation-label">${t('confirm-date')}</span>
                <span class="confirmation-value">${formatDateInLanguage(selectedDate)}</span>
            </div>
            <div class="confirmation-item">
                <span class="confirmation-label">${t('confirm-time')}</span>
                <span class="confirmation-value">${selectedTimeSlot.start} - ${selectedTimeSlot.end}</span>
            </div>
            <div class="confirmation-item">
                <span class="confirmation-label">${t('confirm-duration')}</span>
                <span class="confirmation-value">${formatDurationInLanguage(result.duration)}</span>
            </div>
            <div class="confirmation-item">
                <span class="confirmation-label">${t('confirm-address')}</span>
                <span class="confirmation-value">${addressText}</span>
            </div>
        `;
        
        // Show success step
        document.getElementById('step4').classList.add('hidden');
        document.getElementById('successStep').classList.remove('hidden');
        
    } else {
        const errorMsg = currentLanguage === 'he' 
            ? '砖 拽注转 驻砖: ' + result.message
            : 'Error booking appointment: ' + result.message;
        alert(errorMsg);
    }
}

/**
 * Handle booking error
 */
function handleBookingError(error) {
    // Hide loading overlay
    document.getElementById('loadingOverlay').classList.add('hidden');
    
    const errorMsg = currentLanguage === 'he' 
        ? '砖 拽注转 驻砖.  住 砖.'
        : 'Error booking appointment. Please try again.';
    alert(errorMsg);
    console.error('Booking error:', error);
}

/**
 * Add appointment to client's calendar
 */
function addToCalendar() {
    if (calendarLink) {
        window.open(calendarLink, '_blank');
    } else {
        const errorMsg = currentLanguage === 'he' 
            ? '砖 爪专转 拽砖专 '
            : 'Error creating calendar link';
        alert(errorMsg);
    }
}

/**
 * Reset form to start over
 */
function resetForm() {
    // Reset variables
    currentStep = 1;
    selectedDate = null;
    selectedTimeSlot = null;
    appointmentData = {};
    calendarLink = null;
    
    // Reset form fields
    document.getElementById('clientName').value = '';
    document.getElementById('clientPhone').value = '';
    document.getElementById('clientEmail').value = '';
    document.getElementById('numberOfPeople').value = '';
    document.getElementById('durationInfo').classList.remove('show');
    
    // Reset buttons
    document.getElementById('continueToDate').disabled = true;
    document.getElementById('continueToTime').disabled = true;
    document.getElementById('continueToConfirm').disabled = true;
    
    // Clear errors
    clearErrors();
    
    // Show first step
    document.querySelectorAll('.step-container').forEach(step => step.classList.add('hidden'));
    document.getElementById('step1').classList.remove('hidden');
    
    // Reset calendar
    currentMonth = new Date();
    renderCalendar();
    
    // Scroll to top
    window.scrollTo(0, 0);
}

/**
 * Format date according to current language
 */
function formatDateInLanguage(date) {
    if (currentLanguage === 'he') {
        const days = ['专砖', '砖', '砖砖', '专注', '砖', '砖砖', '砖转'];
        const dayName = days[date.getDay()];
        const day = date.getDate();
        const month = hebrewMonths[date.getMonth()];
        const year = date.getFullYear();
        
        return ` ${dayName}, ${day} ${month} ${year}`;
    } else {
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const dayName = days[date.getDay()];
        const day = date.getDate();
        const month = englishMonths[date.getMonth()];
        const year = date.getFullYear();
        
        return `${dayName}, ${month} ${day}, ${year}`;
    }
}

/**
 * Handle general errors
 */
function handleError(error) {
    console.error('Error:', error);
    const errorMsg = currentLanguage === 'he' 
        ? '专注 砖.  住 砖.'
        : 'An error occurred. Please try again.';
    alert(errorMsg);
}

// Utility function to go to success step
function goToSuccessStep() {
    document.querySelectorAll('.step-container').forEach(step => step.classList.add('hidden'));
    document.getElementById('successStep').classList.remove('hidden');
}

// Make goToStep function work with success step
const originalGoToStep = goToStep;
goToStep = function(step) {
    if (step === 'success') {
        goToSuccessStep();
    } else {
        originalGoToStep(step);
    }
};
</script>
</body>
</html>

